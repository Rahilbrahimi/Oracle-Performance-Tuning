create or replace PACKAGE BODY json_http AS
  FUNCTION success_response (
    p_status  IN NUMBER,
    p_message IN VARCHAR2,
    p_data    IN CLOB
  ) RETURN CLOB IS
    l_json_obj   JSON_OBJECT_T := JSON_OBJECT_T();
    l_uuid       VARCHAR2(36) := LOWER(RAWTOHEX(SYS_GUID()));
  BEGIN
    l_json_obj.put('status', 'success');
    l_json_obj.put('status_code', p_status);
    l_json_obj.put('message', NVL(p_message, 'OK'));

    IF p_data IS NOT NULL THEN
      l_json_obj.put('data', JSON_OBJECT_T.parse(p_data));
    END IF;

    l_json_obj.put('timestamp', TO_CHAR(SYS_EXTRACT_UTC(SYSTIMESTAMP), 'YYYY-MM-DD"T"HH24:MI:SS"Z"'));
    l_json_obj.put('path', '/sql_developer_test');
    l_json_obj.put('request_id',
      SUBSTR(l_uuid, 1, 8) || '-' || SUBSTR(l_uuid, 9, 4) || '-' ||
      SUBSTR(l_uuid, 13, 4) || '-' || SUBSTR(l_uuid, 17, 4) || '-' ||
      SUBSTR(l_uuid, 21));

    RETURN l_json_obj.to_clob();
  END success_response;

  FUNCTION output_response (
    p_response     IN CLOB,
    p_content_type IN VARCHAR2 DEFAULT 'application/json'
  ) RETURN CLOB IS
  BEGIN
    -- توی SQL Developer فقط همون Response رو برمی‌گردونیم
    RETURN p_response;
  END output_response;
END json_http;
